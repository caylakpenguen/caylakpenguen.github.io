<h2 class="date">
	07-Şubat-2014-Cuma  03:46:59
</h2>
<div class="blogbody">
	<a id="e2014-02-07T03_46_59.txt"></a>
	<h3 class="title">Sanal Disk Bölümleme işlemleri</h3>
	Sanal sabit disk ile hiç uğraştınızmı? Sanırım uğraştınız.
Linux ile iç içe olan bir kişi olarak şahsen sıklıkla uğraşıyorum.
Geçenlerde minicik bir sanal sistem oluşturayım dedim.
busybox ile sistemi hazırladım.
test etmek amacıla hazırladığım sistemi Sanal Disk üzerine aktarmak gerekti.

önce 100 Mb boyutunda sanal diski oluşturdum.
<pre>root@truva:~/Disk# dd if=/dev/zero of=Disk.img bs=1M count=100</pre>
üzerinde çalışacağım diski loop aygıtı ile eşledim.
<pre>root@truva:~/Disk# losetup -f --show Disk.img
/dev/loop74
root@truva:~/Disk# </pre>

Ardından Bölümledim :-)
<pre>root@truva:~/Disk# cfdisk /dev/loop74

                          cfdisk (util-linux 2.21.2)

                            Disk Drive: /dev/loop74
                         Size: 104857600 bytes, 104 MB
               Heads: 255   Sectors per Track: 63   Cylinders: 12

    Name        Flags      Part Type  FS Type          [Label]        Size (MB)
 ------------------------------------------------------------------------------
    loop74p1    Boot        Primary   Linux                               82,26
    loop74p2                Primary   Linux swap                          22,61*










     [ Bootable ]  [  Delete  ]  [   Help   ]  [ Maximize ]  [  Print   ]
     [   Quit   ]  [   Type   ]  [  Units   ]  [  Write   ]
 </pre>

Gördüğünüz gibi loop aygıtında bölümler oluştu.
Fakat sistemde bu aygıtları henüz görememekteyiz :)

<pre> root@truva:~/Disk# fdisk -l /dev/loop74

Disk /dev/loop74: 104 MB, 104857600 bytes
255 heads, 63 sectors/track, 12 cylinders, total 204800 sectors
Units = sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disk identifier: 0x00000000

       Device Boot      Start         End      Blocks   Id  System
/dev/loop74p1   *          63      160649       80293+  83  Linux
/dev/loop74p2          160650      204799       22075   82  Linux swap


root@truva:~/Disk# ls /dev/loop74*
/dev/loop74

root@truva:~/Disk#</pre>


Buraya kadar herşey güzel, fakat şimdi sanaldisk üzerindeki bölümleri formatlamaya geldi.
Sanal diskimizi biçimleyebilmek ve mount edebilmek için öncelikler loop devices ile eşlemek gerekli.
sanal disk fiziksel bir çihaz olmadığı için sistem tarafından gerekli aygıtlar oluşturulmaz.<br/>
Hatırlayınız Sistemimize Flash bellek taktığımızda udev tarafından gerekli aygıtlar otomatik oluşturulur  
Örneğin.
<pre> /dev/sdb /dev/sdb1 </pre>

diski biçimlemek ve mount etmek için 3 yol var.
Birincisi Qemu ile oluşturacağımız sanal sistem üzerinden biçimlemek.
ikincisi -o offset değerini hesaplayıp loop aygıtlari ile diskin bölümlerini eşlemek.
üçüncüsü Raid Kullanmak :) Evet Raid :)<br/>
ilk iki seçeneği pas geçip üçüncüsünü anlatmak istiyorum.
öncelikle loop74 devicesini raid yapacağız. 
<pre> root@truva:~/Disk# mdadm --build --force caylakDisk --level linear --raid-devices 1  /dev/loop74
mdadm: array /dev/md/caylakDisk built and started.
root@truva:~/Disk#</pre>
evet raid başladı kontrol edelim diskimiz görünüyormu ?
<pre> root@truva:~/Disk# ls /dev/md/*
/dev/md/caylakDisk  /dev/md/caylakDisk1  /dev/md/caylakDisk2</pre>
Herşey yolunda :)
diskin ilk Bölümünü biçimlendirelim.
<pre> root@truva:~/Disk# mkfs.ext4 /dev/md/caylakDisk1
mke2fs 1.42.6 (21-Sep-2012)
Filesystem label=
OS type: Linux
Block size=1024 (log=0)
Fragment size=1024 (log=0)
Stride=0 blocks, Stripe width=0 blocks
20080 inodes, 80292 blocks
4014 blocks (5.00%) reserved for the super user
First data block=1
Maximum filesystem blocks=67371008
10 block groups
8192 blocks per group, 8192 fragments per group
2008 inodes per group
Superblock backups stored on blocks:
        8193, 24577, 40961, 57345, 73729

Allocating group tables: done
Writing inode tables: done
Creating journal (4096 blocks): done
Writing superblocks and filesystem accounting information: done</pre>

ikinci bölümü takas alanı yapalım.
<pre>root@truva:~/Disk# mkswap /dev/md/caylakDisk2
Setting up swapspace version 1, size = 22068 KiB
no label, UUID=74bc7cac-9b15-49b1-8c5d-e9407b220600
root@truva:~/Disk# </pre>

Herşey Tamam :-)

Mount edelim, deneyelim bakalım Problem çıkacakmı? 

<pre>root@truva:~/Disk# ls /dev/md/*
/dev/md/caylak  /dev/md/caylak1  /dev/md/caylak2
root@truva:~/Disk# mkdir /SanalDisk
root@truva:~/Disk# mount /dev/md/caylak1 /SanalDisk/
root@truva:~/Disk# df
Filesystem     1K-blocks   Used Available Use% Mounted on
aufs             2066656 147808   1918848   8% /
tmpfs            1033328      0   1033328   0% /dev/shm
/dev/md127p1       73653   1550     68089   3% /SanalDisk
root@truva:~/Disk#</pre>

işimiz bittiğine göre son olarak disk bölümünü ayırıp
<pre>root@truva:~/Disk# umount /SanalDisk</pre>

raid stop edelim. 
<pre>root@truva:~/Disk# mdadm --stop /dev/md/caylak
mdadm: stopped /dev/md/caylak</pre>

Görüş ve eleştirilerinizi bekleriz.
</div>

<div class="posted">
	<br />Yazan Çaylak Penguen
| <a class="link" href="../../../../../archives/2014/02/07/sanal_disk_b_l_mleme_i_lemleri/index.html">Kalıcı Bağ</a>
| Bölümler: <!-- linux --><a href="../../../../../archives/linux/index.html">linux</a>
<!-- <br /><a href="../../../../../archives/2014/02/07/sanal_disk_b_l_mleme_i_lemleri/index.html#comments">Yorumlar</a> -->
</div>
